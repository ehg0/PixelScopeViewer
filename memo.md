## app_2.py プロンプト
Pyside6で以下の仕様の画像ビューワを作って。
- メニューバーに、ファイル、画像、表示、解析、ヘルプがある
    - ファイルメニュー
        - 読み込み、全選択、選択領域をコピー、がある
            - 押すとエクスプローラから画像を読み込むことができる。このとき、画像は複数読み込み可能。
            - 画像をドラッグ・アンド・ドロップしても、画像読み込み可能
    - 画像メニュー
        - 次の画像、前の画像、画像を閉じる、がある
        - 画像を読み込むと、画像を閉じる以降に、読み込み画像のフルパスが列挙される。
            - ビューワに表示されている画像の左には黒丸がある。
        - 次の画像、前の画像ボタンを押下すると、表示画像が切り替わる。
        - 画像を閉じるを押すと、表示中の画像が消える
    - 表示メニュー
        - 拡大、縮小、左ビットシフト、右ビットシフトがある。
        - 拡大、縮小を押下すると、2倍、また、半分に拡大縮小される
        - 左ビットシフト、右ビットシフトを押すと、読み込んだ画像の画素値が左、または、右にビットシフトする
    - 解析メニュー
        - 差分画像表示、プロファイル、ヒストグラムがある。
        - 一旦、ボタンがあるだけで、押しても何も起こらない
    - ヘルプメニュー
        - 押下すると、キーボードショートカットの情報が列挙された別画面が表示される
    - キーボードショートカット
        - 全選択 : ctrl + A
        - 選択領域をコピー : ctrl + c
        - 次の画像 : n
        - 前の画像 : b
        - 拡大 : +
        - 縮小 : -
        - 左ビットシフト : <
        - 右ビットシフト : >
- 画像表示に関する仕様
    - 読み込んだ画像の一枚が等倍でビューワ上に表示される
    - 読み込んだ画像は内部では一度numpy配列に変換される。 (後々画像処理を追加実装予定)
    - 画素値は表示の際はint値で表示
    - ステータスバーには以下が表示されている
        - 表示中の画像のファイル名
        - 表示中の画像が読み込んだ画像全体のうち、いくつか (1/20のような形で表示)
        - マウスが表示中の画像上にある場合は、マウスがある個所の表示画像のx,y座標と画素値が表示される
    - ファイルメニュー > 全選択で画像の全領域を選択
    - マウスで左クリックを押しながら動かした領域を短径で選択可能
    - 画像が選択されている状態で、ファイルメニュー > 選択領域をコピーでクリップボードに選択領域の画像をコピー


いくつかバグがある
- 画像メニューには読み込み画像のフルパスを表示してほしい
- 表示画像にマウスオーバーしてもステータスバーにx,y座標、画素値が表示されない

また、機能追加・修正してほしい点がある
- 選択領域を点線で表示するようにしてほしい
- ESC押下で選択解除

以下を修正して。
- pyside_image_viewerの直下にwrapperだけのpythonファイルdialogs.py、utils.py、viewer.py、viewer.pyがあるのが気持ち悪い。
  この形じゃない階層構造に修正して。

以下の機能追加をして。
- 表示画像を拡大・縮小すると、選択領域の表示が消える。消えないように修正。
- ファイルメニューに閉じる、すべて閉じるを追加
    - 閉じるボタンは、画像メニューの画像を閉じるを移植
    - すべて閉じるを押下したときは、読み込んだファイルがすべて消える
- 解析メニューの差分画像表示を 表示メニューに移植
- 表示メニューの差分画像表示を押下すると、別ウィンドウが起動
    - 別ウィンドウ上で、画像を2枚選択でき、選択が完了すると、差分画像が新たに追加表示できるようになる
    - 差分画像のオフセットが設定できる可能。数値入力ダイアログでオフセット値を設定。
        - デフォルト値は256
- 解析メニュー のヒストグラム、または、プロファイルが押下されると、解析結果描画ウィンドウが起動する
    - 解析結果描画ウィンドウの表示領域は、選択領域に対する解析結果が表示される。
    - 表示される解析結果は、選択領域情報、ヒストグラム、プロファイルがタブで切り替え可能
    - ヒストグラムタブには、選択領域の輝度ヒストグラムが表示される
    - プロファイルタブには、選択領域の強度プロファイルが表示される
        - グラフのx軸は絶対アドレス、または、相対アドレス。x軸付近をダブルクリックすると切り替わる
        - グラフのy軸は垂直プロファイル、また、水平プロファイル。y軸付近をダブルクリックすると、切り替わる
            - 水平プロファイルはグラフのx軸が表示画像の水平方向になる
            - 垂直プロファイルはグラフのx軸が表示画像の垂直方向になる
- 選択領域を後からマウスで修正可能




以下修正を行って。
- メイン画面 ステータスバーに表示されている画素値(val)はビットシフトしたとしても、ビットシフトがされてない状態の画素値を表示する
- 解析ダイアログ表示中にメイン画面側で選択領域が再設定された場合、解析ダイアログの表示(ヒストグラム、プロファイルなど)を再計算
- 解析ダイアログに載っている"Size : xx x yy"は常時表示しない。選択コピーできる形態でinfoタブに掲載。
- 解析ダイアログのグラフ(ヒストグラム、プロファイル)
    - 左側に大きめのサイズでグラフを、右側に"channels, axis range, data copy to clipboard"のボタンを縦並びに配置する
    - グラフ
        - x軸y軸に目盛線と補助目盛戦を両方張る
        - 読み込み画像が複数チャンネルある場合、チャンネルを分けて表示。
    - 右側のボタン群
        - 各ボタンを押すと、対応した機能が動作する。必要に応じて、ボタン押下時にウィンドウが追加起動。
    - 右側のボタン : channels
        - チャンネルの表示・非表示が選択できるようにする
    - 右側のボタン : axis range
        - グラフのx軸y軸の最大・最小値がマニュアルで設定できるようにする
    - 右側のボタン : data copy to clipboard
        - データ列がクリップボードに保存される
- analysis.pyが長くなるようなら、メンテナンスしやすいようにファイルを適切に分割。



- 解析ダイアログ
    - Selection sizeなどのinfo情報はinfoタブに表示する
    - channels, axis rangeのウェッジは常時表示しない
    - グラフのタブ (ヒストグラム・プロファイル)
        - 左側にグラフ、右側に"channels, axis range, data copy to clipboard"のボタンが縦並びに並んでる
        - 各ボタンを押すと、今回実装した機能に対応する機能が動作する。必要に応じて、ボタン押下時にウィンドウが追加起動
        - "グラフ上で左クリックしたときのクリップボードのコピー動作は廃止 (左右ダブルクリックしたときの表示軸変換機能が動かなくなったため)


以下の修正をして。
- ステータスバーでファイル > すべて閉じるを選択したら、画像メニューのファイル一覧もすべて消える
- ステータスバーで解析 > ヒストグラム or プロファイルを選択したら、解析ダイアログの対応するタブが有効な状態で解析ダイアログが開く
- 解析ダイアログのグラフ表示中に表示画像を切り替えたら、グラフが更新される
- 解析ダイアログのプロファイルグラフでx軸付近でダブルクリックしたら、絶対アドレスと相対アドレス表記が切り替わるようにする
- analysis.pyのコードが長い。適切にファイル分割したい


表示輝度調整を追加
- メニューバー 表示の直下に"表示輝度調整”メニューを追加
- "表示輝度調整”メニューを押下すると、ウィンドウが立ち上がる
- 立ち上がったウィンドウで以下を調整可能
    - 表示する輝度に対するオフセット、ゲイン、飽和レベルを設定可能
    - yout = gain * (yin  - offset) / saturation * 255 で表示する輝度を規定。ただし、より適切な計算式があれば提案すること
    - オフセット、ゲイン、飽和レベルはスライドバー、SpinBoxで調整可能
    - 入力画像の輝度のデータの型でオフセット、ゲイン、飽和レベルのデータ型が決まる
        - SpinBoxの型もこれに連動
    - オフセットは正負の値、ゲインと飽和レベルは正の値をとる
    - オフセット、ゲインの初期値は0、飽和レベルの初期値は入力画像に依存する
        - 飽和レベルの初期値について
            - jepg, pngなど一般的な画像の場合、255
            - .bin拡張子の場合、1023
            - floatのデータ型の場合、1.0
        - スライドバーの中心値は初期値に連動
    - リセットボタンがあり、このボタンを押下すると、すべてのパラメータが初期値に戻る
- ステータスバーにオフセット、ゲイン、飽和レベルの値を表示
    - ビットシフトの値 "Shift ***"は表示を廃止


現状のコードを最適化したい。
リファクタリングして。
- 重複機能があれば、関数化を検討して。
- 不要・未使用機能コードがあれば、削除して
- 必要に応じて、機能細分化やコードの階層構造見直しを実行して